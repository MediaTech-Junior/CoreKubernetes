# 2장 - 왜 파드인가?

## 이번 장에서 다룰 내용
* 파드란 무엇인가?
* 웹 앱 예제와 파드가 필요한 이유
* 파드를 통한 쿠버네티스 구축 방법
* 쿠버네티스 컨트롤 플레인

## 파드란?
파드는 쿠버네티스 클러스터 노드에서 컨테이너로 실행되는 하나 이상의 OCI 이미지다.
파드도 다른 객체와 동일하게 `YAML`로 정의해서 생성할 수 있다.

```YAML
apiVerrsion: v1
kind: Pod
metadata:
spec:
  container:
  - name: busybox
    image: image:tag
```

대부분의 경우 파드는 직접 배포되지 않는다. 대신, 정의된 `Deployment`, `Job`, `StatefulSet`, `DemonSet` 같은 다양한 `API 객체`에 의해 자동으로 생성된다.

## 쿠버네티스 API 서버
API 서버는 쿠버네티스 클러스터를 위한 다양한 API 객체를 노출하는 `HTTP 기반의 REST 서버`이다.
노드가 시작되면 `kubelet`은 API 서버와 통신을 통해 노드가 클러스터에 등록됐는지 확인한다.
컨트롤 플레인의 모든 컴포넌트는 API 서버의 객체 변경을 모니터링하는 제어 루프를 가지고 있다.

API 서버는 `etcd`와 통신하는 컨트롤 플레인의 유일한 컴포넌트이다.

## 쿠버네티스 스케줄러
스케줄러는 파드 스케줄링 및 배치 동작을 지정하는 `Pod affinity` 및 `Pod anti-affinity` 규칙에 따른다.
또한, `Taint`는 어떤 파드가 노드에 존재하지 않아야 하는가를 결정할 수 있음을 의미한다.

## 확장, 컨트롤 플레인
확장은 기본적으로 `kubectl scale` 명령어를 통해서 할 수 있지만 API 객체에 따라서 다르게 동작한다.
예를 들어 `DemonSet`은 단일 파드로 실행되기 때문에 확장할 수 없다.

### 자동 확장
* `HPA`를 통한 수평적 파드 자동 확장
* `VPA`를 통한 수직정 파드 자동 확장
* 더 많은 노드 생성을 통한 확장

## 고가용성
`kubelet`은 파드의 시작, 중단, 재시작을 포함하는 파드의 수명주기를 담당한다.

### 파드 중단
파드가 실패하는 경우, `kubelet`이 파드의 재시작을 시도하고, 정의된 `liveness probe`를 통해 파드가 실패했거나 파드의 프로세스가 중지된 것을 알 수 있다.

### 노드 중단
`kubelet`은 하트비트를 통해 노드가 정상 상태임을 보고한다.
노드가 하트비트를 충분히 자주 업데이트하지 않으면 노드의 상태는 `KCM`의 컨트롤러에 의해 오프라인 상태로 변경되고, 파드들은 더 이상 해당 노드에 스케줄링되지 않는다.
해당 노드에 존재했던 파드는 삭제가 예약되고 다른 노드에 다시 스케줄한다.


